### **Overview**
- Privilege escalation is required to elevate access from a low-privileged user to a higher privilege (e.g., root on Linux or SYSTEM on Windows).
- Common methods:
    - Exploiting kernel vulnerabilities.
    - Leveraging misconfigured permissions.
    - Exploiting scheduled tasks, exposed credentials, or SSH keys.



### **1. Privilege Escalation Checklists**
- Use online resources like:
    - **HackTricks**: Comprehensive privilege escalation techniques for Linux and Windows.
    - **PayloadsAllTheThings**: Includes commands and examples for exploitation.
- Practice various commands to understand weaknesses.



### **2. Enumeration Scripts**
- Automates enumeration for privilege escalation opportunities.
- Common scripts:
    - **Linux**: `LinEnum`, `linuxprivchecker`, `LinPEAS`.
    - **Windows**: `Seatbelt`, `JAWS`.
    - **Cross-platform**: `PEASS`.
- **Example**:
    ```bash
    ./linpeas.sh
    ```
- **Output Highlights**:
    - Kernel version.
    - SUID binaries.
    - User/group information.
    - Configuration files with sensitive data.

> **Note**: Scripts may trigger antivirus or monitoring systems; manual enumeration is safer in stealthy scenarios.



### **3. Common Privilege Escalation Techniques**
- #### **A. Kernel Exploits**
	- **Description**: Exploit vulnerabilities in outdated kernels.
	- **Steps**:
	    1. Identify kernel version (e.g., `uname -r`).
	    2. Search for exploits:
        ```bash
        searchsploit <kernel_version>
        ```
	    3. Test in a lab before running in production.
- **Example**: Exploiting DirtyCow (`CVE-2016-5195`).
- #### **B. Exploiting Vulnerable Software**
	- **Description**: Identify and exploit installed software.
	- **Commands**:
	    - Linux: `dpkg -l` or `ls /usr/bin/`.
	    - Windows: Inspect `C:\Program Files\`.
	- Search for software vulnerabilities using public exploit databases.
- #### **C. Exploiting User Privileges**
1. **Sudo Misconfigurations**:
    - Check privileges:
        ```bash
        sudo -l
        ```
    - **Example Outputs**:
        - **Full sudo access**:
            ```bash
            sudo su -
            ```
        - **NOPASSWD on specific command**:
            ```bash
            sudo -u user /bin/echo Hello
            ```   
    - Reference **GTFOBins** for exploiting specific binaries.
2. **SUID Binaries**:
    - Search for SUID files:
        ```bash
        find / -perm -4000 2>/dev/null
        ```
    - Exploit binaries for privilege escalation.
3. **Windows Token Privileges**:
    - Enumerate available tokens and exploit them using tools like `Juicy Potato`.
- #### **D. Exploiting Scheduled Tasks**
	- **Linux**: Use writable cron jobs:
	    - Check directories:
	        - `/etc/crontab`
	        - `/etc/cron.d`
	        - `/var/spool/cron/crontabs/root`
	    - Inject malicious commands or scripts.
	- **Windows**:
	    - Add tasks with `schtasks`.
	    - Modify existing tasks to execute malicious payloads.
- #### **E. Exposed Credentials**
	1. **Configuration Files**:
	    - Look for credentials in files like `config.php` or `.env`.
	    - **Example**:
        ```plaintext
        $conn = new mysqli(localhost, 'db_user', 'password123');
        ```
	2. **Password Reuse**:
	    - Test passwords on other accounts:    
        ```bash
        su - user
        ```
	3. **History Files**:
	    - Linux: `.bash_history`
	    - Windows: PSReadLine logs.
- #### **F. SSH Keys**
	1. **Read Private Keys**:
	    - Check `~/.ssh/id_rsa` or `/root/.ssh/id_rsa`.
	    - Use the key to login:
        ```bash
        chmod 600 id_rsa
        ssh root@<target_ip> -i id_rsa
        ```
	2. **Inject Public Keys**:
	    - Generate a key pair:
        ```bash
        ssh-keygen -f key
        ```
    - Add the public key to `authorized_keys`:
        ```bash
        echo "<key.pub_content>" >> ~/.ssh/authorized_keys
        ```
    - Log in using the private key.
 - ### **4. Best Practices**
	- Test exploits in a controlled lab environment.
	- Minimize system impact when running enumeration scripts.
	- Coordinate with clients before executing high-risk exploits.
	- Reference tools like **LOLBAS** (Windows) and **GTFOBins** (Linux).



### Questions
- SSH into the server above with the provided credentials, and use the '-p xxxxxx' to specify the port shown above. Once you login, try to find a way to move to 'user2', to get the flag in '/home/user2/flag.txt'.
	- HTB{l473r4l_m0v3m3n7_70_4n07h3r_u53r}
- Once you gain access to 'user2', try to find a way to escalate your privileges to root, to get the flag in '/root/flag.txt'.
	- HTB{pr1v1l363_35c4l4710n_2_r007}