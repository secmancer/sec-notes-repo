### Introduction
- **Linux Package Management**: Understanding Linux package managers is essential for system administrators, penetration testers, or anyone maintaining Linux systems. Package managers handle the installation, updating, and removal of software packages, which contain binaries, configuration files, and dependency information.
- **Key Features of Package Management**:
    - Package downloading
    - Dependency resolution
    - Standard binary package format
    - Common installation and configuration locations
    - System-related configuration and functionality
    - Quality control
- **Package Types**: Different package formats like `.deb` (Debian-based) and `.rpm` (Red Hat-based) are used, and packages are maintained and distributed by the Linux distributions to integrate software into the system.
- **Dependency Management**: When installing a package, the package manager ensures all required dependencies are also installed. If necessary dependencies are missing, the manager will fetch them from repositories.
- **Package Removal**: When uninstalling software, the package manager manages file deletions and ensures that system configurations are updated accordingly.
- **Popular Package Management Programs**: There are various package managers for different distributions, such as:
    - **APT** (Advanced Package Tool) for Debian/Ubuntu-based systems.
    - **YUM/DNF** for Red Hat/Fedora-based systems.
    - **Zypper** for openSUSE systems.
    - **Pacman** for Arch Linux systems.
![[Screenshot_20241108_220259.png]]
- It is highly recommended to set up our virtual machine (VM) locally to experiment with it. 
- Let us experiment a bit in our local VM and extend it with a few additional packages. 
- First, let us install `git` by using `apt`.



### Advanced Package Manager (APT)
- **APT Package Manager**: Debian-based Linux distributions use the APT (Advanced Package Tool) package manager to install and update software. Packages are archived as ".deb" files, and the `dpkg` utility is used to install them.
- **Dependency Management**: APT simplifies the installation process by automatically handling dependencies. When installing a program, APT ensures that any required additional packages are installed alongside it.
- **Software Repositories**: Linux distributions use software repositories that are regularly updated. When installing or updating programs, the system queries these repositories for the necessary packages. Repositories are often categorized as stable, testing, or unstable, with most systems using the stable repository.
- **Repository Configuration**: The repository list can be checked by viewing the `/etc/apt/sources.list` file. 
- For example, Parrot OS uses `/etc/apt/sources.list.d/parrot.list` for its repository configuration.
```shell-session
secmancer@htb[/htb]$ cat /etc/apt/sources.list.d/parrot.list

# parrot repository
# this file was automatically generated by parrot-mirror-selector
deb http://htb.deb.parrot.sh/parrot/ rolling main contrib non-free
#deb-src https://deb.parrot.sh/parrot/ rolling main contrib non-free
deb http://htb.deb.parrot.sh/parrot/ rolling-security main contrib non-free
#deb-src https://deb.parrot.sh/parrot/ rolling-security main contrib non-free
```
- APT uses a database called the APT cache.
- This is used to provide information about packages installed on our system offline. 
- We can search the APT cache, for example, to find all `Impacket` related packages.
```shell-session
secmancer@htb[/htb]$ apt-cache search impacket

impacket-scripts - Links to useful impacket scripts examples
polenum - Extracts the password policy from a Windows system
python-pcapy - Python interface to the libpcap packet capture library (Python 2)
python3-impacket - Python3 module to easily build and dissect network protocols
python3-pcapy - Python interface to the libpcap packet capture library (Python 3)
```
- We can then view additional information about a package.
```shell-session
secmancer@htb[/htb]$ apt-cache show impacket-scripts

Package: impacket-scripts
Version: 1.4
Architecture: all
Maintainer: Kali Developers <devel@kali.org>
Installed-Size: 13
Depends: python3-impacket (>= 0.9.20), python3-ldap3 (>= 2.5.0), python3-ldapdomaindump
Breaks: python-impacket (<< 0.9.18)
Replaces: python-impacket (<< 0.9.18)
Priority: optional
Section: misc
Filename: pool/main/i/impacket-scripts/impacket-scripts_1.4_all.deb
Size: 2080
<SNIP>
```
- We can also list all installed packages.
```shell-session
secmancer@htb[/htb]$ apt list --installed

Listing... Done
accountsservice/rolling,now 0.6.55-2 amd64 [installed,automatic]
adapta-gtk-theme/rolling,now 3.95.0.11-1 all [installed]
adduser/rolling,now 3.118 all [installed]
adwaita-icon-theme/rolling,now 3.36.1-2 all [installed,automatic]
aircrack-ng/rolling,now 1:1.6-4 amd64 [installed,automatic]
<SNIP>
```
- If we are missing some packages, we can search for it and install it using the following command.
```shell-session
secmancer@htb[/htb]$ sudo apt install impacket-scripts -y

Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  impacket-scripts
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 2,080 B of archives.
After this operation, 13.3 kB of additional disk space will be used.
Get:1 https://euro2-emea-mirror.parrot.sh/mirrors/parrot rolling/main amd64 impacket-scripts all 1.4 [2,080 B]
Fetched 2,080 B in 0s (15.2 kB/s)
Selecting previously unselected package impacket-scripts.
(Reading database ... 378459 files and directories currently installed.)
Preparing to unpack .../impacket-scripts_1.4_all.deb ...
Unpacking impacket-scripts (1.4) ...
Setting up impacket-scripts (1.4) ...
Scanning application launchers
Removing duplicate launchers from Debian
Launchers are updated
```



### Git
- Now that we have `git` installed, we can use it to download useful tools from Github. 
- One such project is called 'Nishang'. We will deal with and work with the project itself later. 
- First, we need to navigate to the [project's repository](https://github.com/samratashok/nishang) and copy the Github link before using git to download it.
- Nevertheless, before we download the project and its scripts and lists, we should create a particular folder.
```shell-session
secmancer@htb[/htb]$ mkdir ~/nishang/ && git clone https://github.com/samratashok/nishang.git ~/nishang

Cloning into '/opt/nishang/'...
remote: Enumerating objects: 15, done.
remote: Counting objects: 100% (15/15), done.
remote: Compressing objects: 100% (13/13), done.
remote: Total 1691 (delta 4), reused 6 (delta 2), pack-reused 1676
Receiving objects: 100% (1691/1691), 7.84 MiB | 4.86 MiB/s, done.
Resolving deltas: 100% (1055/1055), done.
```



### DPKG
- We can also download the programs and tools from the repositories separately.
- In this example, we download 'strace' for Ubuntu 18.04 LTS.
```shell-session
secmancer@htb[/htb]$ wget http://archive.ubuntu.com/ubuntu/pool/main/s/strace/strace_4.21-1ubuntu1_amd64.deb

--2020-05-15 03:27:17--  http://archive.ubuntu.com/ubuntu/pool/main/s/strace/strace_4.21-1ubuntu1_amd64.deb
Resolving archive.ubuntu.com (archive.ubuntu.com)... 91.189.88.142, 91.189.88.152, 2001:67c:1562::18, ...
Connecting to archive.ubuntu.com (archive.ubuntu.com)|91.189.88.142|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 333388 (326K) [application/x-debian-package]
Saving to: ‘strace_4.21-1ubuntu1_amd64.deb’

strace_4.21-1ubuntu1_amd64.deb       100%[===================================================================>] 325,57K  --.-KB/s    in 0,1s    

2020-05-15 03:27:18 (2,69 MB/s) - ‘strace_4.21-1ubuntu1_amd64.deb’ saved [333388/333388]
```
- Furthermore, now we can use both `apt` and `dpkg` to install the package.
- Since we have already worked with `apt`, we will turn to `dpkg` in the next example.
```shell-session
secmancer@htb[/htb]$ sudo dpkg -i strace_4.21-1ubuntu1_amd64.deb 

(Reading database ... 154680 files and directories currently installed.)
Preparing to unpack strace_4.21-1ubuntu1_amd64.deb ...
Unpacking strace (4.21-1ubuntu1) over (4.21-1ubuntu1) ...
Setting up strace (4.21-1ubuntu1) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
```
- With this, we have already installed the tool and can test if it works properly.
```shell-session
secmancer@htb[/htb]$ strace -h

usage: strace [-CdffhiqrtttTvVwxxy] [-I n] [-e expr]...
              [-a column] [-o file] [-s strsize] [-P path]...
              -p pid... / [-D] [-E var=val]... [-u username] PROG [ARGS]
   or: strace -c[dfw] [-I n] [-e expr]... [-O overhead] [-S sortby]
              -p pid... / [-D] [-E var=val]... [-u username] PROG [ARGS]

Output format:
  -a column      alignment COLUMN for printing syscall results (default 40)
  -i             print instruction pointer at time of syscall
```

> Optional Exercise: Search for "**evil-winrm**" tool on Github and install it on our interactive instances. Try all the different installation methods.