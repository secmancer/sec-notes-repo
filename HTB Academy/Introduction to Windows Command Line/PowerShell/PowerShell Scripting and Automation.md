1. **Creating the Script:**
    
    - **File Name and Extension:** Name your file with a `.ps1` extension (e.g., `CheckHostInfo.ps1`). This is your script file.
    - **Define Functions:** Write PowerShell functions for each check you want to perform. Functions help modularize and organize your script. For example, create functions to get the computer name, IP address, domain information, and user directory content.
2. **Creating the Module:**
    
    - **File Name and Extension:** Name your module file with a `.psm1` extension (e.g., `HostInfoModule.psm1`). This file will include the functions you wrote in your script.
    - **Add Functions to Module:** In the `.psm1` file, include the functions from your `.ps1` script. This file can have a single function or multiple functions, depending on your needs.
3. **Creating the Module Manifest:**
    
    - **File Name and Extension:** Create a `.psd1` file (e.g., `HostInfoModule.psd1`). This is the manifest file for your module.
    - **Define Module Metadata:** The `.psd1` file includes metadata about the module like its version, author, and any dependencies. This file is used to describe the contents and settings of your module.
4. **Putting It All Together:**
    
    - **Module Folder Structure:** Organize your module in a folder named after your module (e.g., `HostInfoModule`). Inside this folder, place your `.psm1` and `.psd1` files.
    - **Importing the Module:** To use your module, you can import it into your PowerShell session using `Import-Module` followed by the path to your module folder.
5. **Using Your Module:**
    
    - **Calling Functions:** Once the module is imported, you can call the functions defined in your `.psm1` file from any PowerShell session.

**Module Components**

A module is made up of four essential components:

- **A directory** containing all the required files and content, saved somewhere within `$env:PSModulePath`. This ensures that when you attempt to import it into your PowerShell session or Profile, it can be automatically found without specifying its location.
    
- **A manifest file** listing all files and pertinent information about the module and its function. This includes associated scripts, dependencies, the author, example usage, etc.
    
- **Some code file**—usually either a PowerShell script (_.ps1) or a (_.psm1) module file—that contains your script functions and other information.
    
- **Other resources** the module needs, such as help files, scripts, and other supporting documents.
    

This setup is standard practice but not strictly necessary. We could have our module be just a *.psm1 file containing our scripts and context, skipping the manifest and other helper files. PowerShell would still interpret and understand it. For the sake of propriety, we will build out a standard PowerShell module, including the manifest file and built-in help functionality.

**Making a Directory to Hold Our Module**

Creating a directory is simple. Before proceeding, we need to create the directory to hold our module. This directory should be in one of the paths within `$env:PSModulePath`. If unsure of the paths, you can check by calling the variable. We will create a folder named `quick-recon`:

`mkdir quick-recon`

Now that we have our directory, we can create the module.

**Module Manifest**

A module manifest is a simple *.psd1 file containing a hash table. The keys and values in this hash table:

- Describe the contents and attributes of the module.
- Define prerequisites (specific modules from outside the module itself, variables, functions, etc.).
- Determine how components are processed.

Adding a manifest file allows referencing multiple files as a single unit. The manifest includes:

- Metadata about the module, such as version number, author, and description.
- Prerequisites needed to import the module, like PowerShell version and required modules.
- Processing directives, such as scripts, formats, and types to process.
- Restrictions on module members to export, like aliases, functions, variables, and cmdlets.

We can quickly create a manifest file using `New-ModuleManifest` and specifying the location for it:

`New-ModuleManifest -Path C:\Users\MTanaka\Documents\WindowsPowerShell\Modules\quick-recon\quick-recon.psd1 -PassThru`

This command creates a new manifest file with default settings. The `-PassThru` parameter displays the output in the console. We can then edit the manifest file to add relevant information. All lines in the manifest are optional except for the `ModuleVersion` line.

**Sample Manifest**

Here's a sample manifest configuration:

```
# Module manifest for module 'quick-recon'
#
# Generated by: MTanaka
#
# Generated on: 10/31/2022
#

@{

# Script module or binary module file associated with this manifest.
# RootModule = 'C:\Users\MTanaka\WindowsPowerShell\Modules\quick-recon\quick-recon.psm1'

# Version number of this module.
ModuleVersion = '1.0'

# ID used to uniquely identify this module
GUID = '0a062bb1-8a1b-4bdb-86ed-5adbe1071d2f'

# Author of this module
Author = 'MTanaka'

# Company or vendor of this module
CompanyName = 'Greenhorn.Corp.'

# Copyright statement for this module
Copyright = '(c) 2022 Greenhorn.Corp. All rights reserved.'

# Description of the functionality provided by this module
Description = 'This module will perform several quick checks against the host for Reconnaissance of key information.'

# Functions to export from this module
FunctionsToExport = @()

# Cmdlets to export from this module
CmdletsToExport = @()

# Variables to export from this module
VariablesToExport = '*'

# Aliases to export from this module
AliasesToExport = @()

# List of all modules packaged with this module
# ModuleList = @()

# List of all files packaged with this module
# FileList = @()
}

```


We can update the manifest later to specify the functions, cmdlets, and variables we want to export. First, we need to create and complete our script.

**Create Our Script File**

We create the script file using `New-Item`:

`New-Item quick-recon.psm1 -ItemType File`

This command creates an empty file named `quick-recon.psm1` in the `quick-recon` directory. Now we can fill in this file with our content.

**Importing Modules You Need**

If our new PowerShell module requires other modules or cmdlets, we add an `Import-Module` statement at the beginning of our script file. This works similarly to calling `Import-Module` from within the shell; it loads the necessary modules before running the script. For our module, we need the ActiveDirectory module:

`Import-Module ActiveDirectory`

With the import statement added, we now proceed to define our functions.

**Functions and Doing Work with PowerShell**

Our module needs to perform four main tasks:

- Retrieve the host `ComputerName`
- Retrieve the host's IP configuration
- Retrieve basic domain information
- Retrieve a listing of the "C:\Users" directory

We will use the environment variable `$env:ComputerName` to get the hostname and store it in the `$Hostname` variable. To capture the IP address, we use `ipconfig` and store it in `$IP`. For domain information, we use `Get-ADDomain` and store it in `$Domain`. For the user folders in `C:\Users\`, we use `Get-ChildItem` and store it in `$Users`.

**Variables**

Define the variables as follows:

- `$Hostname = $env:ComputerName`
- `$IP = ipconfig`
- `$Domain = Get-ADDomain`
- `$Users = Get-ChildItem C:\Users\`

**Output Our Info**

To output the collected data, we will write it to a file using `New-Item` and `Add-Content`. We will create a function called `Get-Recon` for this purpose:

The function will:

- Create a new file on the Desktop named `recon.txt`
- Format the data and write it to the file

Here’s how the function is structured:

- `new-Item ~\Desktop\recon.txt -ItemType File` creates the output file.
- `$Vars` holds formatted data including the hostname, domain info, IP info, and user list.
- `Add-Content ~\Desktop\recon.txt $Vars` appends the data to the file.

**Comments Within the Script**

Use `#` for single-line comments and `<# #>` for multi-line comments. Comments help explain what the script does and why:

- `# Collect the hostname of our PC`
- `<# This function performs simple recon tasks. #>`

**Including Help**

PowerShell supports comment-based help using blocks like `<# .Description ... #>`. Place this help section above the function or at the beginning of the script to provide information on usage and examples.

**Protecting Functions**

To protect functions from being exported or specify which functions and variables to export, use `Export-ModuleMember`:

- `Export-ModuleMember -Function Get-Recon -Variable Hostname`

This ensures that only the specified functions and variables are available for export.

**Scope**

PowerShell uses three scope levels:

- **Global**: Affects all objects when PowerShell starts or a new session opens.
- **Local**: The current scope you are operating in.
- **Script**: Temporary scope that applies to the script being run.

Understanding scope helps control access to objects within different parts of a script or session.

**Putting It All Together**

Here is the final module with all components:

- Import the ActiveDirectory module.
- Define the `Get-Recon` function with comments.
- Use `Export-ModuleMember` to specify what to export.
- Save the module in the directory created and import it into PowerShell.